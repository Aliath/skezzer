{"version":3,"file":"index.js","sources":["../../src/Core/Renderer.ts","../../src/Core/Loader.ts","../../src/index.ts"],"sourcesContent":["interface Ground {\r\n  width: number;\r\n  height: number;\r\n  background: CanvasImageSource;\r\n\r\n  onClick?: () => void;\r\n}\r\n\r\ninterface GroundObject {\r\n  getDrawData: () => Ground;\r\n}\r\n\r\ninterface Drawable {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  zIndex: number;\r\n  background: CanvasImageSource;\r\n\r\n  onClick?: () => void;\r\n  backgroundPosition?: { x: number, y: number, };\r\n  backgroundSize?: { width: number, height: number };\r\n}\r\n\r\ninterface DrawableObject {\r\n  getDrawData: () => Drawable;\r\n}\r\n\r\nexport class Renderer {\r\n  private _isRendering: boolean = true;\r\n  private _canvas: HTMLCanvasElement = document.createElement('canvas');\r\n  private _context: CanvasRenderingContext2D = this._canvas.getContext('2d');\r\n  private _ground: GroundObject = null;\r\n  private _centralPoint: DrawableObject = null;\r\n  private _drawableList: DrawableObject[] = [];\r\n  private _width: number = window.innerWidth;\r\n  private _height: number = window.innerHeight;\r\n\r\n\r\n  constructor() {\r\n    this.hide();\r\n    this._bindCanvasEvents();\r\n  }\r\n\r\n  private _bindCanvasEvents = () => {\r\n    window.addEventListener('resize', this._fitCanvasToWindow, false);\r\n    this._canvas.addEventListener('click', this._handleCanvasClick, false);\r\n  }\r\n\r\n  private _getOrderedDrawObjects = () => {\r\n    const { _drawableList, _centralPoint } = this;\r\n\r\n    const drawObjects = [..._drawableList, _centralPoint].map((drawableObject: DrawableObject) => drawableObject.getDrawData());\r\n    return drawObjects.sort((a: Drawable, b: Drawable) => a.zIndex > b.zIndex ? 1 : -1);\r\n  }\r\n\r\n  private _handleCanvasClick = ({ clientX: x, clientY: y }: MouseEvent) => {\r\n    const drawObjects = this._getOrderedDrawObjects();\r\n\r\n    for (let object of drawObjects) {\r\n      const startX = object.x;\r\n      const endX = object.x + object.width;\r\n      const startY = object.y;\r\n      const endY = object.y + object.height;\r\n\r\n      if (x >= startX && x <= endX && y >= startY && y <= endY) {\r\n        if (object.onClick) object.onClick();\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _fitCanvasToWindow = () => {\r\n    this._canvas.width = this._width = window.innerWidth;\r\n    this._canvas.height = this._height = window.innerHeight;\r\n  }\r\n\r\n  hide = () => {\r\n    this._canvas.style.display = 'none';\r\n  }\r\n\r\n  show = () => {\r\n    this._canvas.removeAttribute('style');\r\n  }\r\n\r\n  addDrawable = (drawableObject: DrawableObject) => {\r\n    this._drawableList.push(drawableObject);\r\n  }\r\n\r\n  removeDrawable = (drawableObject: DrawableObject) => {\r\n    this._drawableList = this._drawableList.filter(item => item !== drawableObject);\r\n  }\r\n\r\n  setGround = (ground: DrawableObject) => {\r\n    this._ground = ground;\r\n  }\r\n\r\n  render = () => {\r\n    if (!this._isRendering) return;\r\n    requestAnimationFrame(this.render);\r\n\r\n    const { _width, _height, _context, _ground, _centralPoint } = this;\r\n\r\n    const drawableCentralPoint = _centralPoint.getDrawData();\r\n    const drawableGround = _ground.getDrawData();\r\n\r\n    const centralPointAverageX = drawableCentralPoint.x + drawableCentralPoint.width / 2;\r\n    const centralPointAverageY = drawableCentralPoint.y + drawableCentralPoint.height / 2;\r\n    const mapX = -Math.min(Math.max(0, centralPointAverageX / 2), drawableGround.width - _width / 2);\r\n    const mapY = -Math.min(Math.max(0, centralPointAverageY / 2), drawableGround.height - _height / 2);\r\n\r\n    const orderedDrawObjects = this._getOrderedDrawObjects();\r\n\r\n    _context.clearRect(0, 0, _width, _height);\r\n    _context.drawImage(drawableGround.background, mapX, mapY);\r\n\r\n\r\n    for (let drawableObject of orderedDrawObjects) {\r\n      const { x, y, width, height, background, backgroundPosition, backgroundSize } = drawableObject;\r\n\r\n      _context.drawImage(\r\n        background,\r\n        backgroundPosition.x || 0,\r\n        backgroundPosition.y || 0,\r\n        backgroundSize.width || width,\r\n        backgroundSize.height || height,\r\n        x + mapX,\r\n        y + mapY,\r\n        width,\r\n        height\r\n      );\r\n    }\r\n  }\r\n}","export class Loader {\r\n  ref: HTMLElement;\r\n\r\n  constructor() {\r\n    this.ref = document.getElementById('loader');\r\n  }\r\n\r\n  hide = () => {\r\n    this.ref.classList.add('loader--hidden');\r\n  }\r\n\r\n  show = () => {\r\n    this.ref.classList.remove('loader-hidden');\r\n  }\r\n}","import { Renderer, Loader } from './Core/';\r\n\r\nclass Game {\r\n  renderer: Renderer = new Renderer();\r\n  loader: Loader = new Loader();\r\n\r\n  constructor() {\r\n    setTimeout(() => {\r\n      this.loader.hide();\r\n      this.renderer.show();\r\n    }, 250);\r\n  }\r\n\r\n}\r\n\r\nnew Game();"],"names":[],"mappings":"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"}